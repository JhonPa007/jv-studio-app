{% extends "base.html" %}

{% block title %}Apertura de Caja - JV Studio{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            
            <div class="card bg-dark border-warning shadow-lg">
                
                <div class="card-header border-warning bg-transparent text-center py-4">
                    <div class="mb-3">
                        <span class="fa-stack fa-2x">
                            <i class="fas fa-circle fa-stack-2x text-warning"></i>
                            <i class="fas fa-cash-register fa-stack-1x text-dark"></i>
                        </span>
                    </div>
                    <h2 class="text-light mb-0">Apertura de Caja</h2>
                    <p class="text-muted small">Inicie un nuevo turno de ventas</p>
                </div>

                <div class="card-body p-4">
                    <form action="{{ url_for('main.gestionar_caja') }}" method="POST">
                        
                        {% if monto_sugerido and monto_sugerido > 0 %}
                            <!-- MODO CON SALDO ANTERIOR -->
                            <input type="hidden" id="monto_base" name="monto_base" value="{{ monto_sugerido }}">

                            <div class="mb-3">
                                <label for="saldo_anterior" class="form-label text-light">Saldo en Caja (Turno Anterior)</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-secondary border-secondary text-light fw-bold">S/</span>
                                    <input type="text" id="saldo_anterior" 
                                           class="form-control bg-dark text-light border-secondary" 
                                           value="{{ '%.2f'|format(monto_sugerido|float) }}" readonly>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="monto_adicional" class="form-label text-light">¿Ingresas sencillo adicional?</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-secondary border-secondary text-light fw-bold">S/</span>
                                    <input type="number" step="0.01" min="0" 
                                           class="form-control bg-light text-dark border-secondary fw-bold" 
                                           id="monto_adicional" name="monto_adicional" 
                                           value="0.00" placeholder="0.00" autofocus>
                                </div>
                            </div>

                            <div class="text-center bg-dark-subtle p-3 rounded mb-4 border border-secondary">
                                <h4 class="text-light mb-0">Total Apertura: 
                                    <span id="total_apertura" class="badge bg-success fs-4">S/ {{ '%.2f'|format(monto_sugerido|float) }}</span>
                                </h4>
                            </div>

                        {% else %}
                            <!-- MODO NORMAL (SIN SALDO ANTERIOR) -->
                            <input type="hidden" name="monto_adicional" value="0">
                            <div class="mb-4">
                                <label for="monto_base" class="form-label text-light fs-5 text-center w-100">
                                    ¿Con cuánto dinero inicias?
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-secondary border-secondary text-light fw-bold">S/</span>
                                    <input type="number" step="0.01" min="0" 
                                           class="form-control bg-dark text-warning border-secondary fw-bold text-center" 
                                           style="font-size: 1.5rem;"
                                           id="monto_base" name="monto_base" 
                                           placeholder="0.00" required autofocus>
                                </div>
                                <div class="form-text text-muted text-center mt-2">
                                    Ingrese el sencillo o base en el cajón.
                                </div>
                            </div>
                        {% endif %}

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-warning btn-lg fw-bold text-dark">
                                <i class="fas fa-unlock me-2"></i>ABRIR TURNO
                            </button>
                            <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
                                Cancelar y Volver
                            </a>
                        </div>

                    </form>
                </div>

                <div class="card-footer border-warning bg-transparent text-center">
                    <small class="text-muted">
                        Usuario Responsable: <span class="text-light fw-bold">{{ current_user.nombres }}</span>
                    </small>
                </div>
            </div>

            <div class="text-center mt-3">
                <a href="{{ url_for('main.listar_historial_caja') }}" class="text-muted text-decoration-none small">
                    <i class="fas fa-history me-1"></i> Ver Historial de Cajas Anteriores
                </a>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const montoBaseInput = document.getElementById('monto_base');
    const montoAdicionalInput = document.getElementById('monto_adicional');
    const totalAperturaSpan = document.getElementById('total_apertura');

    if (montoBaseInput && montoAdicionalInput) {
        montoAdicionalInput.addEventListener('input', function() {
            const base = parseFloat(montoBaseInput.value) || 0;
            const adicional = parseFloat(montoAdicionalInput.value) || 0;
            const total = base + adicional;
            
            totalAperturaSpan.textContent = `S/ ${total.toFixed(2)}`;
        });
    }
});
</script>
{% endblock %}