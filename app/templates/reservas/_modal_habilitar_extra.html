<!-- Modal para Habilitar Horas Extra -->
<div class="modal fade" id="modalHabilitarExtra" tabindex="-1" aria-labelledby="modalHabilitarExtraLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 12px;">
            <div class="modal-header border-0 pb-0">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body pt-1 px-4 pb-4">
                <h4 class="modal-title fw-bold mb-1" id="modalHabilitarExtraLabel">Turno Extra</h4>
                <p class="text-muted small mb-4">Establecer turno adicional para <span id="habilitarNombreEmpleado"
                        class="fw-bold text-dark"></span> el <span id="habilitarFechaTxt"></span></p>

                <form id="formHabilitarExtra">
                    <input type="hidden" id="habilitarEmpleadoId" name="empleado_id">
                    <input type="hidden" id="habilitarFecha" name="fecha">

                    <div class="row g-3 items-center">
                        <div class="col-6">
                            <label class="form-label small fw-bold text-uppercase text-muted">Hora de inicio</label>
                            <input type="time" class="form-control form-control-lg" id="habilitarHoraInicio"
                                name="hora_inicio" required>
                        </div>
                        <div class="col-6">
                            <label class="form-label small fw-bold text-uppercase text-muted">Hora de
                                finalización</label>
                            <input type="time" class="form-control form-control-lg" id="habilitarHoraFin"
                                name="hora_fin" required>
                        </div>
                    </div>

                    <div class="mt-2 text-end">
                        <small class="text-muted" id="habilitarDuracionTxt">0 min</small>
                    </div>

                    <div class="mb-4 mt-3">
                        <label class="form-label small fw-bold text-secondary">Nota / Motivo (Opcional)</label>
                        <input type="text" class="form-control" name="motivo" placeholder="Ej. Apoyo temporada alta">
                    </div>

                    <div id="habilitarError" class="alert alert-danger p-2 small" style="display: none;"></div>

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <button type="button" class="btn btn-light border" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-dark px-4">Guardar Turno</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Cálculo de duración
    function actualizarDuracionExtra() {
        const ini = document.getElementById('habilitarHoraInicio').value;
        const fin = document.getElementById('habilitarHoraFin').value;
        if (!ini || !fin) return;

        const [h1, m1] = ini.split(':').map(Number);
        const [h2, m2] = fin.split(':').map(Number);

        const d1 = new Date(); d1.setHours(h1, m1);
        const d2 = new Date(); d2.setHours(h2, m2);

        let diff = (d2 - d1) / 60000;
        if (diff < 0) diff += 1440;

        let txt = "";
        if (diff >= 60) {
            const h = Math.floor(diff / 60);
            const m = diff % 60;
            txt = `Duración total: ${h}h ${m > 0 ? m + 'min' : ''}`;
        } else {
            txt = `Duración total: ${diff} min`;
        }
        document.getElementById('habilitarDuracionTxt').innerText = txt;
    }

    document.getElementById('habilitarHoraInicio').addEventListener('change', actualizarDuracionExtra);
    document.getElementById('habilitarHoraFin').addEventListener('change', actualizarDuracionExtra);
</script>