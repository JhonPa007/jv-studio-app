{% extends "base.html" %}

{% block title %}{{ titulo_pagina | default('Historial de Compras') }} - JV Studio{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 style="color: var(--color-acento-dorado);"><i class="fas fa-history me-2"></i>{{ titulo_pagina }}</h2>
        <a href="{{ url_for('main.nueva_compra') }}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Registrar Nueva Compra
        </a>
    </div>

  

    {% if compras %}
    <div class="table-responsive">
        <table class="table table-hover table-custom table-sm">
            <thead>
                <tr>
                    <th>ID Compra</th>
                    <th>Fecha</th>
                    <th>Proveedor</th>
                    <th>Sucursal</th>
                    <th>Comprobante</th>
                    <th>Monto Total (S/)</th>
                    <th>Estado Pago</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for compra_item in compras %}
                <tr>
                    <td>{{ compra_item.compra_id }}</td>
                    <td>{{ compra_item.fecha_compra.strftime('%d/%m/%Y') if compra_item.fecha_compra else '-' }}</td>
                    <td>{{ compra_item.proveedor_nombre }}</td>
                    <td>{{ compra_item.sucursal_nombre }}</td>
                    <td>
                        {% if compra_item.tipo_comprobante %}
                            {{ compra_item.tipo_comprobante }}<br>
                            <small class="text-muted">{{ compra_item.serie_numero_comprobante }}</small>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="text-end">{{ "%.2f"|format(compra_item.monto_total) }}</td>
                    <td>
                        {# Podríamos usar badges de colores como en la lista de ventas #}
                        <span class="badge p-2 {% if compra_item.estado_pago == 'Pagada' %}bg-success{% elif compra_item.estado_pago == 'Pendiente de Pago' or compra_item.estado_pago == 'Crédito' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">
                            {{ compra_item.estado_pago }}
                        </span>
                    </td>
                    <td class="table-actions">
                        <a href="{{ url_for('main.ver_detalle_compra', compra_id=compra_item.compra_id) }}" class="btn btn-xs btn-info" title="Ver Detalle"><i class="fas fa-eye"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info-custom">
        <i class="fas fa-info-circle me-2"></i>No hay compras registradas todavía.
    </div>
    {% endif %}
</div>
{% endblock %}